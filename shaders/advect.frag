precision mediump float;vec3 a(vec3 b){return vec3(mod(gl_FragCoord.x,b.x),gl_FragCoord.y,floor(gl_FragCoord.x/b.x)+0.5);}vec4 c(sampler2D d,vec3 e,vec3 b){vec3 f=e*b;f=clamp(f,vec3(0.5),vec3(b-0.5));float g=floor(f.z-0.5);float h=g+1.0;float i=fract(f.z-0.5);vec2 j=vec2(g*b.x+f.x,f.y)/vec2(b.x*b.z,b.y);vec2 k=vec2(h*b.x+f.x,f.y)/vec2(b.x*b.z,b.y);return mix(texture2D(d,j),texture2D(d,k),i);}vec4 l(sampler2D d,vec3 e,vec3 b){vec3 f=e*b;f=clamp(f,vec3(0.5),vec3(b-0.5));float m=floor(f.z);vec2 n=vec2(m*b.x+f.x,f.y)/vec2(b.x*b.z,b.y);return texture2D(d,n);}varying vec2 v_coordinates;uniform sampler2D u_positionsTexture;uniform sampler2D u_randomsTexture;uniform sampler2D u_velocityGrid;uniform vec3 u_gridResolution;uniform vec3 u_gridSize;uniform float u_timeStep;uniform float u_frameNumber;uniform vec2 u_particlesResolution;float o(vec3 p){vec3 q=vec3(p.x,p.y-0.5,p.z-0.5);return c(u_velocityGrid,(q+0.5)/(u_gridResolution+1.0),u_gridResolution+1.0).x;}float r(vec3 p){vec3 q=vec3(p.x-0.5,p.y,p.z-0.5);return c(u_velocityGrid,(q+0.5)/(u_gridResolution+1.0),u_gridResolution+1.0).y;}float s(vec3 p){vec3 q=vec3(p.x-0.5,p.y-0.5,p.z);return c(u_velocityGrid,(q+0.5)/(u_gridResolution+1.0),u_gridResolution+1.0).z;}vec3 t(vec3 p){vec3 u=(p/u_gridSize)*u_gridResolution;return vec3(o(u),r(u),s(u));}void main(){vec3 p=texture2D(u_positionsTexture,v_coordinates).rgb;vec3 v=texture2D(u_randomsTexture,fract(v_coordinates+u_frameNumber/u_particlesResolution)).rgb;vec3 w=t(p);vec3 x=p+w*u_timeStep*0.5;vec3 y=t(x);vec3 z=y*u_timeStep;z+=0.05*v*length(w)*u_timeStep;vec3 A=p+z;A=clamp(A,vec3(0.01),u_gridSize-0.01);gl_FragColor=vec4(A,0.0);}